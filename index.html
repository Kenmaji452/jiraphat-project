<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ระบบเช็กชื่อ (Firebase)</title>
  <style>
    html,body {margin:0;padding:0;height:100%;background:#000;color:#fff;font-family:sans-serif; overflow:hidden;}
    .signin {padding:10px;position:relative;z-index:1;height:100vh;display:flex;align-items:center;justify-content:center;flex-direction:column;}
    section {position:absolute;top:0;left:0;width:100vw;height:100vh;display:grid;grid-template:repeat(10,1fr)/repeat(20,1fr);z-index:0;}
    section span{width:100%;height:100%;background:#181818;border:2px solid black;animation:borderFade 4s linear infinite;transition:background 1.5s;box-sizing:border-box;}
    section span:hover{background:#f00;transition:0s;}
    @keyframes borderFade{0%,100%{border-color:black;}50%{border-color:red;}}
    input,button{width:90%;max-width:300px;margin:10px auto;padding:12px 20px;border:2px solid red;background:#000;color:#fff;font-size:18px;border-radius:8px;box-sizing:border-box;cursor:pointer;}
    .hidden{display:none;}
    #adminBtn{position:absolute;right:20px;bottom:20px;padding:8px 12px;font-size:14px;border-radius:6px;}
    @media(max-width:600px){input,button{font-size:16px;padding:10px 15px;}#adminBtn{right:10px;bottom:10px;}}
  </style><!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>ระบบเช็กชื่อ</title>
  <style>
    html, body {
      margin: 0; padding: 0; height: 100%; background: #000;
      font-family: sans-serif; color: white;
    }
    .container {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      min-height: 100vh;
      padding: 20px;
    }
    input, button {
      margin: 5px;
      padding: 10px 15px;
      font-size: 16px;
      border-radius: 8px;
      border: 2px solid red;
      background: black;
      color: white;
      width: 100%;
      max-width: 300px;
    }
    button.selected {
      border: 2px solid lime;
      background: #040;
    }
    .hidden { display: none; }
    #menu, #checkinForm, #registerForm, #loginForm, #adminAccess, #allUserData {
      width: 100%;
      max-width: 400px;
    }
    h1, h2 {
      text-align: center;
    }
    #adminBtn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 10;
    }
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>
<body>
  <div class="container">
    <h1>ระบบเช็กชื่อ</h1>

    <div id="menu">
      <button onclick="showLogin()">ลงชื่อเข้าใช้</button>
      <button onclick="showRegister()">สมัคร</button>
    </div>

    <div id="loginForm" class="hidden">
      <h2>ลงชื่อเข้าใช้</h2>
      <input type="text" id="loginFullname" placeholder="ชื่อ-สกุล">
      <input type="text" id="loginNickname" placeholder="ชื่อเล่น">
      <button onclick="loginUser()">เข้าสู่ระบบ</button>
    </div>

    <div id="registerForm" class="hidden">
      <h2>สมัคร</h2>
      <input type="text" id="regFullname" placeholder="ชื่อ-สกุล">
      <input type="text" id="regNickname" placeholder="ชื่อเล่น">
      <input type="password" id="regPassword" placeholder="รหัสผ่าน">
      <input type="password" id="regConfirmPassword" placeholder="ยืนยันรหัสผ่าน">
      <button onclick="registerUser()">สมัคร</button>
    </div>

    <div id="checkinForm" class="hidden">
      <h2>เช็กชื่อ</h2>
      <div id="checkinName"></div>
      <button id="btnPresent" onclick="setCheckin('มาเรียน')">มาเรียน</button>
      <button id="btnAbsent" onclick="setCheckin('ลาเรียน')">ลาเรียน</button>
      <button onclick="submitCheckin()">ส่ง</button>
    </div>

    <div id="adminAccess" class="hidden">
      <h2>เข้าสู่ระบบผู้ดูแล</h2>
      <input type="password" id="adminPassword" placeholder="รหัสผ่านผู้ดูแล">
      <button onclick="accessAllUsers()">เข้าสู่ระบบ</button>
    </div>

    <div id="allUserData" class="hidden">
      <h2>ข้อมูลผู้ใช้ทั้งหมด</h2>
      <div id="userDataDisplay"></div>
    </div>
  </div>
  <button id="adminBtn" onclick="showAdminAccess()">ข้อมูลผู้ใช้ทั้งหมด</button>

  <script>
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      databaseURL: "YOUR_DB_URL",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_BUCKET",
      messagingSenderId: "YOUR_MSG_ID",
      appId: "YOUR_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let current = null;
    let checkinStatus = '';

    function hideAll() {
      document.querySelectorAll('.container > div').forEach(el => el.classList.add('hidden'));
    }

    function showLogin() {
      hideAll();
      document.getElementById('loginForm').classList.remove('hidden');
    }

    function showRegister() {
      hideAll();
      document.getElementById('registerForm').classList.remove('hidden');
    }

    function showAdminAccess() {
      hideAll();
      document.getElementById('adminAccess').classList.remove('hidden');
    }

    function registerUser() {
      const fullname = regFullname.value.trim();
      const nickname = regNickname.value.trim();
      const password = regPassword.value;
      const confirmPassword = regConfirmPassword.value;
      if (!fullname || !nickname || !password || !confirmPassword) return alert("กรุณากรอกข้อมูลให้ครบ");
      if (password !== confirmPassword) return alert("รหัสผ่านไม่ตรงกัน");
      const userRef = db.ref("users").push();
      userRef.set({ fullname, nickname, password, checkins: {} }, () => {
        current = { key: userRef.key, fullname };
        document.getElementById('checkinName').innerText = fullname;
        hideAll();
        document.getElementById('checkinForm').classList.remove('hidden');
      });
    }

    function loginUser() {
      const fullname = loginFullname.value.trim();
      const nickname = loginNickname.value.trim();
      if (!fullname || !nickname) return alert("กรุณากรอกข้อมูลให้ครบ");
      db.ref("users").once("value", snap => {
        let found = false;
        snap.forEach(child => {
          const u = child.val();
          if (u.fullname === fullname && u.nickname === nickname) {
            current = { key: child.key, fullname };
            document.getElementById('checkinName').innerText = fullname;
            hideAll();
            document.getElementById('checkinForm').classList.remove('hidden');
            found = true;
          }
        });
        if (!found) alert("ไม่พบผู้ใช้");
      });
    }

    function setCheckin(st) {
      checkinStatus = st;
      btnPresent.classList.toggle('selected', st === 'มาเรียน');
      btnAbsent.classList.toggle('selected', st === 'ลาเรียน');
    }

    function submitCheckin() {
      if (!current || !checkinStatus) return alert("กรุณาเลือกสถานะก่อนส่ง");
      const c = { status: checkinStatus, time: new Date().toLocaleString() };
      db.ref(`users/${current.key}/checkins`).push(c, () => {
        alert("บันทึกแล้ว");
        checkinStatus = '';
        btnPresent.classList.remove('selected');
        btnAbsent.classList.remove('selected');
      });
    }

    function accessAllUsers() {
      const pass = adminPassword.value;
      if (pass !== '46534') return alert("รหัสผ่านไม่ถูกต้อง");
      hideAll();
      document.getElementById('allUserData').classList.remove('hidden');
      const out = document.getElementById("userDataDisplay");
      out.innerHTML = 'กำลังโหลด...';
      db.ref("users").once("value", snap => {
        let html = '';
        snap.forEach((child, i) => {
          const u = child.val();
          html += `<hr><b>ผู้ใช้ที่ ${i + 1}</b><br>ชื่อ: ${u.fullname}<br>ชื่อเล่น: ${u.nickname}<br>`;
          html += `การเช็กชื่อ:<ul>`;
          for (let k in u.checkins) {
            const c = u.checkins[k];
            html += `<li>${c.status} - ${c.time}</li>`;
          }
          html += '</ul>';
        });
        out.innerHTML = html || 'ไม่มีข้อมูล';
      });
    }
  </script>
</body>
</html>
