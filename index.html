<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ระบบเช็กชื่อ (Firebase)</title>
  <style>
    html,body {margin:0;padding:0;height:100%;background:#000;color:#fff;font-family:sans-serif; overflow:hidden;}
    .signin {padding:10px;position:relative;z-index:1;height:100vh;display:flex;align-items:center;justify-content:center;flex-direction:column;}
    section {position:absolute;top:0;left:0;width:100vw;height:100vh;display:grid;grid-template:repeat(10,1fr)/repeat(20,1fr);z-index:0;}
    section span{width:100%;height:100%;background:#181818;border:2px solid black;animation:borderFade 4s linear infinite;transition:background 1.5s;box-sizing:border-box;}
    section span:hover{background:#f00;transition:0s;}
    @keyframes borderFade{0%,100%{border-color:black;}50%{border-color:red;}}
    input,button{width:90%;max-width:300px;margin:10px auto;padding:12px 20px;border:2px solid red;background:#000;color:#fff;font-size:18px;border-radius:8px;box-sizing:border-box;cursor:pointer;}
    .hidden{display:none;}
    #adminBtn{position:absolute;right:20px;bottom:20px;padding:8px 12px;font-size:14px;border-radius:6px;}
    @media(max-width:600px){input,button{font-size:16px;padding:10px 15px;}#adminBtn{right:10px;bottom:10px;}}
  </style>
</head>
<body>

<section></section>
<div class="signin">
  <h1>ระบบเช็กชื่อ</h1>
  <div id="menu">
    <button onclick="showLogin()">ลงชื่อเข้าใช้</button>
    <button onclick="showRegister()">สมัคร</button>
  </div>
  <button id="adminBtn" onclick="showAdmin()">ข้อมูลผู้ใช้ทั้งหมด</button>

  <div id="loginForm" class="hidden">
    <h2>ลงชื่อเข้าใช้</h2>
    <input id="loginNickname" placeholder="ชื่อเล่น">
    <input id="loginPassword" type="password" placeholder="รหัสผ่าน">
    <button onclick="login()">ลงชื่อเข้าใช้</button>
  </div>

  <div id="registerForm" class="hidden">
    <h2>สมัคร</h2>
    <input id="regFullname" placeholder="ชื่อ-สกุล">
    <input id="regNickname" placeholder="ชื่อเล่น">
    <input id="regPassword" type="password" placeholder="รหัสผ่าน">
    <input id="regConfirm" type="password" placeholder="ยืนยันรหัสผ่าน">
    <button onclick="register()">สมัคร</button>
  </div>

  <div id="checkinForm" class="hidden">
    <h2>เช็กชื่อ: <span id="userDisplay"></span></h2>
    <button onclick="setCheckin('มาเรียน')">มาเรียน</button>
    <button onclick="setCheckin('ลาเรียน')">ลาเรียน</button>
    <button onclick="submitCheckin()">ส่ง</button>
  </div>

  <div id="adminForm" class="hidden">
    <h2>ดูข้อมูลผู้ใช้ทั้งหมด</h2>
    <input id="adminPass" type="password" placeholder="รหัสผ่าน admin">
    <button onclick="adminLoad()">ดูข้อมูล</button>
  </div>

  <div id="adminView" class="hidden">
    <h2>ข้อมูลผู้ใช้ทั้งหมด</h2>
    <div id="allUsers"></div>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    databaseURL: "https://YOUR_PROJECT.firebaseio.com",
    projectId: "YOUR_PROJECT",
    //... rest of config
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  let current = null, checkinStatus = '';

  const hideAll = () => {
    document.querySelectorAll('.signin > div, .signin > button').forEach(el => {
      if (!['menu','adminBtn'].includes(el.id)) el.classList.add('hidden');
    });
  };
  const showLogin =()=>{hideAll();document.getElementById('loginForm').classList.remove('hidden');};
  const showRegister =()=>{hideAll();document.getElementById('registerForm').classList.remove('hidden');};
  const showAdmin =()=>{hideAll();document.getElementById('adminForm').classList.remove('hidden');};

  function register(){
    const fn=regFullname.value.trim(), nn=regNickname.value.trim();
    const pw=regPassword.value, cf=regConfirm.value;
    if(!(fn&&nn&&pw)) return alert('กรอกข้อมูลให้ครบ');
    if(pw!==cf) return alert('รหัสไม่ตรงกัน');
    const newUser = { fullname:fn, nickname:nn, password:pw, checkins:{} };
    db.ref('users').orderByChild('nickname').equalTo(nn)
      .once('value', snap=>{
        if(snap.exists()) return alert('ชื่อเล่นถูกใช้แล้ว');
        db.ref('users').push(newUser,()=>{
          current= { key:null, ...newUser }; current.nickname=nn;
          db.ref('users').orderByChild('nickname').equalTo(nn)
            .once('value',s=>{
              const key=Object.keys(s.val())[0];
              current.key=key;
              userDisplay.innerText=fn;
              hideAll();checkinForm.classList.remove('hidden');
            });
        });
      });
  }

  function login(){
    const nn=loginNickname.value.trim(), pw=loginPassword.value;
    if(!(nn&&pw)) return alert('กรอกข้อมูลให้ครบ');
    db.ref('users').orderByChild('nickname').equalTo(nn)
      .once('value', snap=>{
        if(!snap.exists()) return alert('ไม่พบผู้ใช้');
        const data=snap.val();
        const key=Object.keys(data)[0], u=data[key];
        if(u.password!==pw) return alert('รหัสไม่ถูกต้อง');
        current={ key, ...u };
        userDisplay.innerText=u.fullname;
        hideAll();checkinForm.classList.remove('hidden');
      });
  }

  function setCheckin(st){ checkinStatus=st; }

  function submitCheckin(){
    if(!current || !checkinStatus) return alert('ยังไม่ได้เลือกสถานะ');
    const c = { status:checkinStatus, time: new Date().toLocaleString() };
    db.ref(`users/${current.key}/checkins`).push(c,()=>{
      alert('บันทึกเรียบร้อย');
      checkinStatus='';
    });
  }

  function adminLoad(){
    if(adminPass.value!=='46534') return alert('รหัส admin ไม่ถูกต้อง');
    db.ref('users').once('value',snap=>{
      allUsers.innerHTML='';
      snap.forEach(u=>{
        const data=u.val();
        let html=`<hr><p><b>${data.fullname} (${data.nickname})</b><br>`;
        html+=`เช็กชื่อ:<ul>`;
        for(const k in data.checkins){
          const ci=data.checkins[k];
          html+=`<li>${ci.status} - ${ci.time}</li>`;
        }
        html+='</ul></p>';
        allUsers.innerHTML+=html;
      });
      hideAll();adminView.classList.remove('hidden');
    });
  }

  // ฟูลกริด
  const container=document.querySelector('section');
  for(let r=0;r<10;r++) for(let c=0;c<20;c++){
    const s=document.createElement('span');
    s.style.animationDelay=(r*0.2)+'s';
    container.appendChild(s);
  }
</script>

</body>
</html>
