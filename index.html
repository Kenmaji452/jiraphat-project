<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Å‡∏ä‡∏∑‡πà‡∏≠</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    html, body {
      margin: 0; padding: 0; height: 100%; background: #000;
      font-family: sans-serif; color: white; overflow: hidden;
    }
    .signin {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      flex-direction: column;
      position: relative;
      z-index: 1;
    }
    section {
      display: grid;
      width: 100vw;
      height: 100vh;
      grid-template-columns: repeat(20, 1fr);
      grid-template-rows: repeat(10, 1fr);
      position: absolute;
      top: 0; left: 0;
      z-index: 0;
    }
    section span {
      display: block;
      width: 100%;
      height: 100%;
      background: #181818;
      border: 2px solid black;
      animation: borderFade 4s linear infinite;
      transition: background 1.5s;
      box-sizing: border-box;
    }
    section span:hover {
      background: #f00;
      transition: background 0s;
    }
    @keyframes borderFade {
      0%, 100% { border-color: black; }
      50% { border-color: red; }
    }
    input, button, select {
      display: block;
      margin: 5px auto;
      padding: 5px 10px;
      border: 2px solid red;
      background: black;
      color: white;
      font-size: 16px;
    }
    .hidden { display: none; }
    #menu, #userControls {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    #adminBtn {
      position: absolute;
      bottom: 20px;
      right: 20px;
    }
    #userInfo {
      position: absolute;
      top: 10px;
      left: 20px;
      font-size: 18px;
      background: rgba(255, 255, 255, 0.1);
      padding: 5px 10px;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <section></section>
  <div class="signin">
    <div id="userInfo" class="hidden"></div>
    <h1>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Å‡∏ä‡∏∑‡πà‡∏≠</h1>

    <div id="menu">
      <button onclick="showLogin()">‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ</button>
      <button onclick="showRegister()">‡∏™‡∏°‡∏±‡∏Ñ‡∏£</button>
    </div>

    <div id="userControls" class="hidden">
      <button onclick="viewHistory()">‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</button>
      <button onclick="logout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>

    <button id="adminBtn" onclick="showUserAccess()">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>

    <div id="loginForm" class="hidden">
      <h2>‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ</h2>
      <input type="text" id="loginFullname" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•">
      <input type="number" id="loginAge" placeholder="‡∏≠‡∏≤‡∏¢‡∏∏">
      <input type="text" id="loginNickname" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô">
      <button onclick="loginUser()">‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ</button>
    </div>

    <div id="registerForm" class="hidden">
      <h2>‡∏™‡∏°‡∏±‡∏Ñ‡∏£</h2>
      <input type="text" id="regFullname" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•">
      <input type="text" id="regNickname" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô">
      <input type="password" id="regPassword" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
      <input type="password" id="regConfirmPassword" placeholder="‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
      <select id="regRole">
        <option value="student">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
        <option value="teacher">‡∏Ñ‡∏£‡∏π</option>
      </select>
      <button onclick="registerUser()">‡∏™‡∏°‡∏±‡∏Ñ‡∏£</button>
    </div>

    <div id="checkinForm" class="hidden">
      <h2>‡πÄ‡∏ä‡πá‡∏Å‡∏ä‡∏∑‡πà‡∏≠</h2>
      <div id="checkinName"></div>
      <button onclick="setCheckinStatus('‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô')">‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
      <button onclick="setCheckinStatus('‡∏•‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô')">‡∏•‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
      <button onclick="submitCheckin()">‡∏™‡πà‡∏á</button>
    </div>

    <div id="adminAccess" class="hidden">
      <h2>‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
      <input type="password" id="adminPassword" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
      <button onclick="accessAllUsers()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>

    <div id="allUserData" class="hidden">
      <h2>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
      <div id="userDataDisplay"></div>
    </div>

    <div id="userHistory" class="hidden">
      <h2>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h2>
      <canvas id="checkinChart" width="300" height="150"></canvas>
      <div id="userHistoryDisplay"></div>
    </div>
  </div>

  <script>
    const container = document.querySelector('section');
    const rows = 10;
    const cols = 20;
    for (let row = 0; row < rows; row++) {
      for (let col = 0; col < cols; col++) {
        const span = document.createElement('span');
        span.style.animationDelay = (row * 0.2) + 's';
        container.appendChild(span);
      }
    }

    let users = JSON.parse(localStorage.getItem('users') || '[]');
    let currentUser = null;
    let checkinStatus = '';

    function hideAll() {
      document.querySelectorAll('.signin > div, .signin > button').forEach(el => {
        if (el.id !== 'menu' && el.id !== 'adminBtn' && el.id !== 'userInfo') {
          el.classList.add('hidden');
        }
      });
    }

    function showLogin() {
      hideAll();
      document.getElementById('loginForm').classList.remove('hidden');
    }

    function showRegister() {
      hideAll();
      document.getElementById('registerForm').classList.remove('hidden');
    }

    function showUserAccess() {
      hideAll();
      document.getElementById('adminAccess').classList.remove('hidden');
    }

    function registerUser() {
      const fullname = document.getElementById('regFullname').value;
      const nickname = document.getElementById('regNickname').value;
      const password = document.getElementById('regPassword').value;
      const confirmPassword = document.getElementById('regConfirmPassword').value;
      const role = document.getElementById('regRole').value;

      if (password !== confirmPassword) return alert("‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô");

      const user = {
        fullname,
        nickname,
        password,
        role,
        age: null,
        checkins: [],
        points: 100,
        penalties: []
      };

      users.push(user);
      localStorage.setItem('users', JSON.stringify(users));
      currentUser = user;
      document.getElementById('checkinName').innerText = fullname;
      updateUserInfo();
      hideAll();
      if (role === 'student') {
        document.getElementById('checkinForm').classList.remove('hidden');
        document.getElementById('userControls').classList.remove('hidden');
      } else {
        showUserAccess();
      }
    }

    function loginUser() {
      const fullname = document.getElementById('loginFullname').value;
      const age = document.getElementById('loginAge').value;
      const nickname = document.getElementById('loginNickname').value;

      const user = users.find(u => u.fullname === fullname && u.nickname === nickname);
      if (!user) return alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ");

      user.age = age;
      currentUser = user;
      document.getElementById('checkinName').innerText = fullname;
      updateUserInfo();
      hideAll();
      if (user.role === 'student') {
        document.getElementById('checkinForm').classList.remove('hidden');
        document.getElementById('userControls').classList.remove('hidden');
      } else {
        showUserAccess();
      }
    }

    function updateUserInfo() {
      if (currentUser) {
        const info = `üë§ ${currentUser.fullname} | ‡∏¢‡∏®: ${currentUser.role} | ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${currentUser.points}`;
        document.getElementById('userInfo').innerText = info;
        document.getElementById('userInfo').classList.remove('hidden');
      } else {
        document.getElementById('userInfo').classList.add('hidden');
      }
    }

    function setCheckinStatus(status) {
      checkinStatus = status;
    }

    function submitCheckin() {
      if (!currentUser) return;
      const now = new Date();
      currentUser.checkins.push({ status: checkinStatus, time: now.toLocaleString() });
      localStorage.setItem('users', JSON.stringify(users));
      alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß");
      updateUserInfo();
    }

    function accessAllUsers() {
      const pass = document.getElementById('adminPassword').value;
      if (pass !== '46534') return alert("‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");

      hideAll();
      document.getElementById('allUserData').classList.remove('hidden');

      let html = '';
      users.forEach((u, i) => {
        html += `<hr><b>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà ${i + 1}</b><br>‡∏ä‡∏∑‡πà‡∏≠: ${u.fullname}<br>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô: ${u.nickname}<br>‡∏¢‡∏®: ${u.role}<br>‡∏≠‡∏≤‡∏¢‡∏∏: ${u.age || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}<br>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${u.points}<br>`;
        html += `‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Å‡∏ä‡∏∑‡πà‡∏≠:<ul>`;
        u.checkins.forEach(ci => {
          html += `<li>${ci.status} - ${ci.time}</li>`;
        });
        html += '</ul>';
        if (currentUser && currentUser.role === 'teacher') {
          html += `<div>‡∏´‡∏±‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô:
            <button onclick="deductPoints(${i}, 5)">-5</button>
            <button onclick="deductPoints(${i}, 10)">-10</button>
            <button onclick="deductPoints(${i}, 20)">-20</button>
            <input type='text' id='reason${i}' placeholder='‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•'>
          </div>`;
        }
      });

      document.getElementById('userDataDisplay').innerHTML = html;
    }

    function deductPoints(index, amount) {
      const reason = document.getElementById(`reason${index}`).value;
      if (!reason) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•");
      users[index].points -= amount;
      users[index].penalties.push({ amount, reason, time: new Date().toLocaleString() });
      localStorage.setItem('users', JSON.stringify(users));
      alert("‡∏´‡∏±‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏•‡πâ‡∏ß");
      accessAllUsers();
    }

    function viewHistory() {
      if (!currentUser) return;
      hideAll();
      document.getElementById('userHistory').classList.remove('hidden');

      const history = currentUser.checkins.map(c => `${c.status} - ${c.time}`);
      document.getElementById('userHistoryDisplay').innerHTML = `<ul><li>` + history.join('</li><li>') + '</li></ul>';

      const counts = currentUser.checkins.reduce((acc, ci) => {
        acc[ci.status] = (acc[ci.status] || 0) + 1;
        return acc;
      }, {});

      new Chart(document.getElementById('checkinChart'), {
        type: 'bar',
        data: {
          labels: Object.keys(counts),
          datasets: [{
            label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
            data: Object.values(counts),
            backgroundColor: ['green', 'orange', 'red']
          }]
        },
        options: {
          scales: {
            y: { beginAtZero: true }
          }
        }
      });
    }

    function logout() {
      currentUser = null;
      checkinStatus = '';
      updateUserInfo();
      hideAll();
      document.getElementById('menu').classList.remove('hidden');
    }
  </script>
</body>
</html>
