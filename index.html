<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ระบบเช็กชื่อ</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      background: #000;
      color: white;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .container {
      text-align: center;
      max-width: 400px;
      width: 100%;
    }
    input, button {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      font-size: 16px;
      border: 2px solid red;
      background: #111;
      color: white;
      box-sizing: border-box;
    }
    button.active {
      border-color: lime;
      background-color: #222;
    }
    .hidden {
      display: none;
    }
    #userDataDisplay {
      text-align: left;
      max-height: 300px;
      overflow-y: auto;
      background: #111;
      padding: 10px;
      border: 1px solid red;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ระบบเช็กชื่อ</h1>

    <div id="menu">
      <button id="loginBtn">ลงชื่อเข้าใช้</button>
      <button id="registerBtn">สมัคร</button>
      <button id="adminBtn">ข้อมูลผู้ใช้ทั้งหมด</button>
    </div>

    <div id="loginForm" class="hidden">
      <input type="text" id="loginFullname" placeholder="ชื่อ-สกุล" />
      <input type="number" id="loginAge" placeholder="อายุ" />
      <input type="text" id="loginNickname" placeholder="ชื่อเล่น" />
      <button id="loginSubmit">เข้าสู่ระบบ</button>
    </div>

    <div id="registerForm" class="hidden">
      <input type="text" id="regFullname" placeholder="ชื่อ-สกุล" />
      <input type="text" id="regNickname" placeholder="ชื่อเล่น" />
      <input type="password" id="regPassword" placeholder="รหัสผ่าน" />
      <input type="password" id="regConfirmPassword" placeholder="ยืนยันรหัสผ่าน" />
      <button id="registerSubmit">สมัคร</button>
    </div>

    <div id="checkinForm" class="hidden">
      <h3 id="checkinName"></h3>
      <button class="checkinBtn" data-status="มาเรียน">เข้าเรียน</button>
      <button class="checkinBtn" data-status="ลาเรียน">ลาเรียน</button>
      <button id="checkinSubmit">ส่ง</button>
    </div>

    <div id="adminForm" class="hidden">
      <input type="password" id="adminPassword" placeholder="รหัสผ่านผู้ดูแลระบบ" />
      <button id="adminLogin">เข้าสู่ระบบ</button>
    </div>

    <div id="userData" class="hidden">
      <h2>ข้อมูลผู้ใช้ทั้งหมด</h2>
      <div id="userDataDisplay"></div>
    </div>
  </div>

  <script>
    const users = JSON.parse(localStorage.getItem("users") || "[]");
    let currentUser = null;
    let selectedStatus = "";

    const el = id => document.getElementById(id);

    function show(id) {
      document.querySelectorAll(".container > div").forEach(d => d.classList.add("hidden"));
      if (id) el(id).classList.remove("hidden");
    }

    el("loginBtn").onclick = () => show("loginForm");
    el("registerBtn").onclick = () => show("registerForm");
    el("adminBtn").onclick = () => show("adminForm");

    el("registerSubmit").onclick = () => {
      const fullname = el("regFullname").value.trim();
      const nickname = el("regNickname").value.trim();
      const pass = el("regPassword").value;
      const confirm = el("regConfirmPassword").value;
      if (!fullname || !nickname || !pass || !confirm || pass !== confirm) {
        alert("กรอกข้อมูลให้ครบและรหัสผ่านต้องตรงกัน");
        return;
      }
      const user = { fullname, nickname, password: pass, age: null, checkins: [] };
      users.push(user);
      localStorage.setItem("users", JSON.stringify(users));
      currentUser = user;
      el("checkinName").innerText = fullname;
      show("checkinForm");
    };

    el("loginSubmit").onclick = () => {
      const fullname = el("loginFullname").value.trim();
      const nickname = el("loginNickname").value.trim();
      const age = el("loginAge").value;
      const user = users.find(u => u.fullname === fullname && u.nickname === nickname);
      if (!user) return alert("ไม่พบผู้ใช้");
      user.age = age;
      currentUser = user;
      el("checkinName").innerText = fullname;
      show("checkinForm");
    };

    document.querySelectorAll(".checkinBtn").forEach(btn => {
      btn.onclick = () => {
        selectedStatus = btn.dataset.status;
        document.querySelectorAll(".checkinBtn").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
      };
    });

    el("checkinSubmit").onclick = () => {
      if (!currentUser || !selectedStatus) return alert("กรุณาเลือกสถานะก่อน");
      const now = new Date();
      currentUser.checkins.push({ status: selectedStatus, time: now.toLocaleString() });
      localStorage.setItem("users", JSON.stringify(users));
      alert("บันทึกสำเร็จ");
      show("menu");
    };

    el("adminLogin").onclick = () => {
      const pw = el("adminPassword").value;
      if (pw !== "123456") return alert("รหัสผ่านไม่ถูกต้อง");
      show("userData");
      const html = users.map((u, i) => {
        return `<div><b>ผู้ใช้ ${i + 1}</b><br>ชื่อ: ${u.fullname}<br>ชื่อเล่น: ${u.nickname}<br>อายุ: ${u.age || "-"}<br>` +
               `<ul>` + u.checkins.map(c => `<li>${c.status} - ${c.time}</li>`).join("") + `</ul></div><hr>`;
      }).join("");
      el("userDataDisplay").innerHTML = html;
    };
  </script>
</body>
</html>
